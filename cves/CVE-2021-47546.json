{
    "id": 251721,
    "name": "CVE-2021-47546",
    "cwe": "CWE-401",
    "modified": "2024-06-10T16:30:20",
    "published": "2024-05-24T13:15:19",
    "status": "Analyzed",
    "summary": "In the Linux kernel, the following vulnerability has been resolved:\n\nipv6: fix memory leak in fib6_rule_suppress\n\nThe kernel leaks memory when a `fib` rule is present in IPv6 nftables\nfirewall rules and a suppress_prefix rule is present in the IPv6 routing\nrules (used by certain tools such as wg-quick). In such scenarios, every\nincoming packet will leak an allocation in `ip6_dst_cache` slab cache.\n\nAfter some hours of `bpftrace`-ing and source code reading, I tracked\ndown the issue to ca7a03c41753 (\"ipv6: do not free rt if\nFIB_LOOKUP_NOREF is set on suppress rule\").\n\nThe problem with that change is that the generic `args->flags` always have\n`FIB_LOOKUP_NOREF` set[1][2] but the IPv6-specific flag\n`RT6_LOOKUP_F_DST_NOREF` might not be, leading to `fib6_rule_suppress` not\ndecreasing the refcount when needed.\n\nHow to reproduce:\n - Add the following nftables rule to a prerouting chain:\n     meta nfproto ipv6 fib saddr . mark . iif oif missing drop\n   This can be done with:\n     sudo nft create table inet test\n     sudo nft create chain inet test test_chain '{ type filter hook prerouting priority filter + 10; policy accept; }'\n     sudo nft add rule inet test test_chain meta nfproto ipv6 fib saddr . mark . iif oif missing drop\n - Run:\n     sudo ip -6 rule add table main suppress_prefixlength 0\n - Watch `sudo slabtop -o | grep ip6_dst_cache` to see memory usage increase\n   with every incoming ipv6 packet.\n\nThis patch exposes the protocol-specific flags to the protocol\nspecific `suppress` function, and check the protocol-specific `flags`\nargument for RT6_LOOKUP_F_DST_NOREF instead of the generic\nFIB_LOOKUP_NOREF when decreasing the refcount, like this.\n\n[1]: https://github.com/torvalds/linux/blob/ca7a03c4175366a92cee0ccc4fec0038c3266e26/net/ipv6/fib6_rules.c#L71\n[2]: https://github.com/torvalds/linux/blob/ca7a03c4175366a92cee0ccc4fec0038c3266e26/net/ipv6/fib6_rules.c#L99",
    "cvss3": {
        "cvss": 5.5,
        "exploitability_score": 1.8,
        "impact_score": 3.6,
        "vector": "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H"
    },
    "cvss2": null,
    "cpes": [
        {
            "id": 453533
        },
        {
            "id": 453950
        },
        {
            "id": 461180
        },
        {
            "id": 468276
        },
        {
            "id": 483224
        },
        {
            "id": 483621
        },
        {
            "id": 483622
        },
        {
            "id": 483623
        },
        {
            "id": 483624
        },
        {
            "id": 483625
        },
        {
            "id": 483626
        },
        {
            "id": 483627
        },
        {
            "id": 483628
        },
        {
            "id": 483629
        },
        {
            "id": 483630
        },
        {
            "id": 483631
        },
        {
            "id": 483632
        },
        {
            "id": 483633
        },
        {
            "id": 483634
        },
        {
            "id": 483635
        },
        {
            "id": 505953
        },
        {
            "id": 505954
        },
        {
            "id": 505955
        },
        {
            "id": 505956
        },
        {
            "id": 505957
        },
        {
            "id": 512081
        },
        {
            "id": 520171
        },
        {
            "id": 520172
        },
        {
            "id": 520173
        },
        {
            "id": 520174
        },
        {
            "id": 520175
        },
        {
            "id": 520176
        },
        {
            "id": 520177
        },
        {
            "id": 520178
        },
        {
            "id": 520179
        },
        {
            "id": 520180
        },
        {
            "id": 520181
        },
        {
            "id": 522757
        },
        {
            "id": 524568
        },
        {
            "id": 527261
        },
        {
            "id": 534299
        },
        {
            "id": 541116
        },
        {
            "id": 545816
        },
        {
            "id": 545823
        },
        {
            "id": 548384
        },
        {
            "id": 549281
        },
        {
            "id": 549282
        },
        {
            "id": 560333
        },
        {
            "id": 568881
        },
        {
            "id": 568882
        },
        {
            "id": 568883
        },
        {
            "id": 578926
        },
        {
            "id": 588470
        },
        {
            "id": 589141
        },
        {
            "id": 590391
        },
        {
            "id": 590562
        },
        {
            "id": 591060
        },
        {
            "id": 591235
        },
        {
            "id": 591236
        },
        {
            "id": 591237
        },
        {
            "id": 591238
        },
        {
            "id": 591239
        },
        {
            "id": 591241
        },
        {
            "id": 591243
        },
        {
            "id": 591244
        },
        {
            "id": 591245
        },
        {
            "id": 591246
        },
        {
            "id": 591247
        },
        {
            "id": 597953
        },
        {
            "id": 597954
        },
        {
            "id": 597955
        },
        {
            "id": 597956
        },
        {
            "id": 597957
        },
        {
            "id": 597958
        },
        {
            "id": 597959
        },
        {
            "id": 597960
        },
        {
            "id": 597961
        },
        {
            "id": 597962
        },
        {
            "id": 597963
        },
        {
            "id": 597964
        },
        {
            "id": 597965
        },
        {
            "id": 597966
        },
        {
            "id": 597967
        },
        {
            "id": 599612
        },
        {
            "id": 599874
        },
        {
            "id": 599875
        },
        {
            "id": 600274
        },
        {
            "id": 604561
        },
        {
            "id": 604562
        },
        {
            "id": 604563
        },
        {
            "id": 604564
        },
        {
            "id": 604565
        },
        {
            "id": 604566
        },
        {
            "id": 606415
        },
        {
            "id": 614510
        },
        {
            "id": 614582
        },
        {
            "id": 614583
        },
        {
            "id": 614584
        },
        {
            "id": 614585
        },
        {
            "id": 614586
        },
        {
            "id": 614587
        },
        {
            "id": 614750
        },
        {
            "id": 615514
        },
        {
            "id": 616063
        },
        {
            "id": 618218
        },
        {
            "id": 620076
        },
        {
            "id": 620077
        },
        {
            "id": 628944
        },
        {
            "id": 628945
        },
        {
            "id": 629670
        },
        {
            "id": 629702
        },
        {
            "id": 635282
        },
        {
            "id": 636053
        },
        {
            "id": 637145
        },
        {
            "id": 637146
        },
        {
            "id": 637147
        },
        {
            "id": 637148
        },
        {
            "id": 637149
        },
        {
            "id": 637150
        },
        {
            "id": 638132
        },
        {
            "id": 640797
        },
        {
            "id": 641971
        },
        {
            "id": 641972
        },
        {
            "id": 641973
        },
        {
            "id": 641974
        },
        {
            "id": 641975
        },
        {
            "id": 641976
        },
        {
            "id": 641977
        },
        {
            "id": 641978
        },
        {
            "id": 641979
        },
        {
            "id": 646212
        },
        {
            "id": 646213
        },
        {
            "id": 646214
        },
        {
            "id": 647069
        },
        {
            "id": 649189
        },
        {
            "id": 649190
        },
        {
            "id": 649191
        },
        {
            "id": 650094
        },
        {
            "id": 652291
        },
        {
            "id": 652292
        },
        {
            "id": 652293
        },
        {
            "id": 652294
        },
        {
            "id": 655463
        },
        {
            "id": 655464
        },
        {
            "id": 655465
        },
        {
            "id": 656345
        },
        {
            "id": 658021
        },
        {
            "id": 663024
        },
        {
            "id": 663025
        },
        {
            "id": 663026
        },
        {
            "id": 671543
        },
        {
            "id": 671544
        },
        {
            "id": 672941
        },
        {
            "id": 672942
        },
        {
            "id": 672943
        },
        {
            "id": 672944
        },
        {
            "id": 672945
        },
        {
            "id": 672946
        },
        {
            "id": 672947
        },
        {
            "id": 672948
        },
        {
            "id": 672949
        },
        {
            "id": 672950
        },
        {
            "id": 672951
        },
        {
            "id": 672952
        },
        {
            "id": 672953
        },
        {
            "id": 672954
        },
        {
            "id": 672955
        },
        {
            "id": 672956
        },
        {
            "id": 672957
        },
        {
            "id": 672958
        },
        {
            "id": 672959
        },
        {
            "id": 672960
        },
        {
            "id": 672961
        },
        {
            "id": 672962
        },
        {
            "id": 672963
        },
        {
            "id": 672964
        },
        {
            "id": 672965
        },
        {
            "id": 672966
        },
        {
            "id": 672967
        },
        {
            "id": 672968
        },
        {
            "id": 672969
        },
        {
            "id": 672970
        },
        {
            "id": 672971
        },
        {
            "id": 672972
        },
        {
            "id": 673897
        },
        {
            "id": 673898
        },
        {
            "id": 673899
        },
        {
            "id": 673900
        },
        {
            "id": 673901
        },
        {
            "id": 677335
        },
        {
            "id": 677336
        },
        {
            "id": 677337
        },
        {
            "id": 684027
        },
        {
            "id": 687818
        },
        {
            "id": 687819
        },
        {
            "id": 687820
        },
        {
            "id": 690122
        },
        {
            "id": 690123
        },
        {
            "id": 690124
        },
        {
            "id": 690125
        },
        {
            "id": 690928
        },
        {
            "id": 690929
        },
        {
            "id": 690930
        },
        {
            "id": 707092
        },
        {
            "id": 708473
        },
        {
            "id": 708474
        },
        {
            "id": 708475
        },
        {
            "id": 708530
        },
        {
            "id": 709221
        },
        {
            "id": 709222
        },
        {
            "id": 709496
        },
        {
            "id": 711247
        },
        {
            "id": 711248
        },
        {
            "id": 711249
        },
        {
            "id": 711250
        },
        {
            "id": 711251
        },
        {
            "id": 711252
        },
        {
            "id": 711253
        },
        {
            "id": 711254
        },
        {
            "id": 711255
        },
        {
            "id": 711256
        },
        {
            "id": 711257
        },
        {
            "id": 717230
        },
        {
            "id": 718165
        },
        {
            "id": 718511
        },
        {
            "id": 718512
        },
        {
            "id": 718513
        },
        {
            "id": 718514
        },
        {
            "id": 718515
        },
        {
            "id": 718516
        },
        {
            "id": 718517
        },
        {
            "id": 718956
        },
        {
            "id": 719001
        },
        {
            "id": 726447
        },
        {
            "id": 726448
        },
        {
            "id": 726449
        },
        {
            "id": 726450
        },
        {
            "id": 726451
        },
        {
            "id": 726452
        },
        {
            "id": 726453
        },
        {
            "id": 726454
        },
        {
            "id": 726455
        },
        {
            "id": 726456
        },
        {
            "id": 726457
        },
        {
            "id": 726458
        },
        {
            "id": 726459
        },
        {
            "id": 726460
        },
        {
            "id": 726461
        },
        {
            "id": 726462
        },
        {
            "id": 726463
        },
        {
            "id": 726464
        },
        {
            "id": 726465
        },
        {
            "id": 726466
        },
        {
            "id": 726467
        },
        {
            "id": 726468
        },
        {
            "id": 726469
        },
        {
            "id": 726470
        },
        {
            "id": 726471
        },
        {
            "id": 726472
        },
        {
            "id": 726473
        },
        {
            "id": 726479
        },
        {
            "id": 742164
        },
        {
            "id": 742165
        },
        {
            "id": 742166
        },
        {
            "id": 742167
        },
        {
            "id": 752980
        },
        {
            "id": 752981
        },
        {
            "id": 752983
        },
        {
            "id": 752984
        },
        {
            "id": 752989
        },
        {
            "id": 752990
        },
        {
            "id": 754455
        },
        {
            "id": 754456
        },
        {
            "id": 754457
        },
        {
            "id": 754557
        },
        {
            "id": 754558
        },
        {
            "id": 754559
        },
        {
            "id": 754560
        },
        {
            "id": 760679
        },
        {
            "id": 768383
        },
        {
            "id": 768384
        },
        {
            "id": 768385
        },
        {
            "id": 768386
        },
        {
            "id": 768387
        },
        {
            "id": 780049
        },
        {
            "id": 780050
        },
        {
            "id": 780051
        },
        {
            "id": 780052
        },
        {
            "id": 780187
        },
        {
            "id": 780188
        },
        {
            "id": 780189
        },
        {
            "id": 780190
        },
        {
            "id": 780191
        },
        {
            "id": 780192
        },
        {
            "id": 780193
        },
        {
            "id": 780194
        },
        {
            "id": 780195
        },
        {
            "id": 780863
        },
        {
            "id": 780864
        },
        {
            "id": 780865
        },
        {
            "id": 780866
        },
        {
            "id": 780867
        },
        {
            "id": 780868
        },
        {
            "id": 780869
        },
        {
            "id": 780870
        },
        {
            "id": 780871
        },
        {
            "id": 799197
        },
        {
            "id": 799198
        },
        {
            "id": 799199
        },
        {
            "id": 799200
        },
        {
            "id": 799201
        },
        {
            "id": 804763
        },
        {
            "id": 804764
        },
        {
            "id": 804765
        },
        {
            "id": 804766
        },
        {
            "id": 804767
        },
        {
            "id": 804768
        },
        {
            "id": 804769
        },
        {
            "id": 805346
        },
        {
            "id": 805347
        },
        {
            "id": 822035
        },
        {
            "id": 822036
        },
        {
            "id": 822037
        },
        {
            "id": 822038
        },
        {
            "id": 832570
        },
        {
            "id": 832571
        },
        {
            "id": 832572
        },
        {
            "id": 832573
        },
        {
            "id": 832574
        },
        {
            "id": 832575
        },
        {
            "id": 832576
        },
        {
            "id": 855336
        },
        {
            "id": 862142
        },
        {
            "id": 862143
        },
        {
            "id": 862144
        },
        {
            "id": 862145
        },
        {
            "id": 862146
        },
        {
            "id": 862147
        },
        {
            "id": 862148
        },
        {
            "id": 862149
        },
        {
            "id": 862150
        },
        {
            "id": 862151
        },
        {
            "id": 862152
        },
        {
            "id": 862153
        },
        {
            "id": 890568
        },
        {
            "id": 890569
        },
        {
            "id": 890570
        },
        {
            "id": 890571
        },
        {
            "id": 890572
        },
        {
            "id": 890573
        },
        {
            "id": 890574
        },
        {
            "id": 890575
        },
        {
            "id": 890576
        },
        {
            "id": 890577
        },
        {
            "id": 890578
        },
        {
            "id": 890579
        },
        {
            "id": 890580
        },
        {
            "id": 890581
        },
        {
            "id": 890582
        },
        {
            "id": 890583
        },
        {
            "id": 890584
        },
        {
            "id": 890585
        },
        {
            "id": 890586
        },
        {
            "id": 890587
        },
        {
            "id": 890588
        },
        {
            "id": 890589
        },
        {
            "id": 890590
        },
        {
            "id": 890591
        },
        {
            "id": 890592
        },
        {
            "id": 890593
        },
        {
            "id": 890594
        },
        {
            "id": 931625
        },
        {
            "id": 951636
        },
        {
            "id": 951637
        },
        {
            "id": 951638
        },
        {
            "id": 951639
        },
        {
            "id": 951640
        },
        {
            "id": 951641
        },
        {
            "id": 951642
        },
        {
            "id": 951643
        },
        {
            "id": 951644
        },
        {
            "id": 951645
        },
        {
            "id": 951646
        },
        {
            "id": 951647
        },
        {
            "id": 951648
        },
        {
            "id": 951649
        },
        {
            "id": 951650
        },
        {
            "id": 951651
        },
        {
            "id": 951652
        },
        {
            "id": 951653
        },
        {
            "id": 951654
        },
        {
            "id": 951655
        },
        {
            "id": 951656
        },
        {
            "id": 951657
        },
        {
            "id": 951658
        },
        {
            "id": 951659
        },
        {
            "id": 951660
        },
        {
            "id": 951661
        },
        {
            "id": 951662
        },
        {
            "id": 951663
        },
        {
            "id": 951664
        },
        {
            "id": 951665
        },
        {
            "id": 951666
        },
        {
            "id": 951667
        },
        {
            "id": 951668
        },
        {
            "id": 951669
        },
        {
            "id": 951670
        },
        {
            "id": 951671
        },
        {
            "id": 951672
        },
        {
            "id": 951673
        },
        {
            "id": 951674
        },
        {
            "id": 951675
        },
        {
            "id": 951676
        },
        {
            "id": 951693
        },
        {
            "id": 951694
        },
        {
            "id": 951695
        },
        {
            "id": 951696
        },
        {
            "id": 951697
        },
        {
            "id": 951698
        },
        {
            "id": 951699
        },
        {
            "id": 951780
        },
        {
            "id": 951781
        },
        {
            "id": 951782
        },
        {
            "id": 951783
        },
        {
            "id": 951784
        },
        {
            "id": 951785
        },
        {
            "id": 951786
        },
        {
            "id": 951787
        },
        {
            "id": 951788
        },
        {
            "id": 951789
        },
        {
            "id": 951790
        },
        {
            "id": 951791
        },
        {
            "id": 951792
        },
        {
            "id": 951793
        },
        {
            "id": 951794
        },
        {
            "id": 951795
        },
        {
            "id": 951796
        },
        {
            "id": 951797
        },
        {
            "id": 951798
        },
        {
            "id": 951799
        },
        {
            "id": 951800
        },
        {
            "id": 951801
        },
        {
            "id": 951802
        },
        {
            "id": 951803
        },
        {
            "id": 951804
        },
        {
            "id": 951805
        },
        {
            "id": 951806
        },
        {
            "id": 951807
        },
        {
            "id": 951808
        },
        {
            "id": 951809
        },
        {
            "id": 951810
        },
        {
            "id": 951811
        },
        {
            "id": 951812
        },
        {
            "id": 951813
        },
        {
            "id": 951814
        },
        {
            "id": 951815
        },
        {
            "id": 951816
        },
        {
            "id": 951817
        },
        {
            "id": 951818
        },
        {
            "id": 951819
        },
        {
            "id": 951820
        },
        {
            "id": 951821
        },
        {
            "id": 951822
        },
        {
            "id": 951823
        },
        {
            "id": 951824
        },
        {
            "id": 951825
        },
        {
            "id": 951826
        },
        {
            "id": 951827
        },
        {
            "id": 951828
        },
        {
            "id": 951829
        },
        {
            "id": 951830
        },
        {
            "id": 951831
        },
        {
            "id": 951832
        },
        {
            "id": 951833
        },
        {
            "id": 951834
        },
        {
            "id": 951835
        },
        {
            "id": 951836
        },
        {
            "id": 951837
        },
        {
            "id": 951838
        },
        {
            "id": 951839
        },
        {
            "id": 951840
        },
        {
            "id": 951841
        },
        {
            "id": 951897
        },
        {
            "id": 951898
        },
        {
            "id": 951899
        },
        {
            "id": 951900
        },
        {
            "id": 951901
        },
        {
            "id": 951902
        },
        {
            "id": 951903
        },
        {
            "id": 951904
        },
        {
            "id": 951905
        },
        {
            "id": 951906
        },
        {
            "id": 951907
        },
        {
            "id": 951908
        },
        {
            "id": 951909
        },
        {
            "id": 951910
        },
        {
            "id": 951911
        },
        {
            "id": 951912
        },
        {
            "id": 951913
        },
        {
            "id": 951914
        },
        {
            "id": 951915
        },
        {
            "id": 951916
        },
        {
            "id": 951917
        },
        {
            "id": 951918
        },
        {
            "id": 951919
        },
        {
            "id": 951920
        },
        {
            "id": 951921
        },
        {
            "id": 951922
        },
        {
            "id": 951923
        },
        {
            "id": 951924
        },
        {
            "id": 951925
        },
        {
            "id": 951926
        },
        {
            "id": 951927
        },
        {
            "id": 981147
        },
        {
            "id": 1018126
        },
        {
            "id": 1056955
        },
        {
            "id": 1056956
        },
        {
            "id": 1056957
        },
        {
            "id": 1056958
        },
        {
            "id": 1056959
        },
        {
            "id": 1056960
        },
        {
            "id": 1056961
        },
        {
            "id": 1056962
        },
        {
            "id": 1066689
        },
        {
            "id": 1066690
        },
        {
            "id": 1066691
        },
        {
            "id": 1066692
        },
        {
            "id": 1066693
        },
        {
            "id": 1096972
        },
        {
            "id": 1097650
        },
        {
            "id": 1097651
        },
        {
            "id": 1097652
        },
        {
            "id": 1097653
        },
        {
            "id": 1097654
        },
        {
            "id": 1097655
        },
        {
            "id": 1097656
        },
        {
            "id": 1097657
        },
        {
            "id": 1097658
        },
        {
            "id": 1267330
        },
        {
            "id": 1267332
        }
    ]
}