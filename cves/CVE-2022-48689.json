{
    "id": 248535,
    "name": "CVE-2022-48689",
    "cwe": "CWE-362",
    "modified": "2024-05-23T18:33:57",
    "published": "2024-05-03T13:15:07",
    "status": "Analyzed",
    "summary": "In the Linux kernel, the following vulnerability has been resolved:\n\ntcp: TX zerocopy should not sense pfmemalloc status\n\nWe got a recent syzbot report [1] showing a possible misuse\nof pfmemalloc page status in TCP zerocopy paths.\n\nIndeed, for pages coming from user space or other layers,\nusing page_is_pfmemalloc() is moot, and possibly could give\nfalse positives.\n\nThere has been attempts to make page_is_pfmemalloc() more robust,\nbut not using it in the first place in this context is probably better,\nremoving cpu cycles.\n\nNote to stable teams :\n\nYou need to backport 84ce071e38a6 (\"net: introduce\n__skb_fill_page_desc_noacc\") as a prereq.\n\nRace is more probable after commit c07aea3ef4d4\n(\"mm: add a signature in struct page\") because page_is_pfmemalloc()\nis now using low order bit from page->lru.next, which can change\nmore often than page->index.\n\nLow order bit should never be set for lru.next (when used as an anchor\nin LRU list), so KCSAN report is mostly a false positive.\n\nBackporting to older kernel versions seems not necessary.\n\n[1]\nBUG: KCSAN: data-race in lru_add_fn / tcp_build_frag\n\nwrite to 0xffffea0004a1d2c8 of 8 bytes by task 18600 on cpu 0:\n__list_add include/linux/list.h:73 [inline]\nlist_add include/linux/list.h:88 [inline]\nlruvec_add_folio include/linux/mm_inline.h:105 [inline]\nlru_add_fn+0x440/0x520 mm/swap.c:228\nfolio_batch_move_lru+0x1e1/0x2a0 mm/swap.c:246\nfolio_batch_add_and_move mm/swap.c:263 [inline]\nfolio_add_lru+0xf1/0x140 mm/swap.c:490\nfilemap_add_folio+0xf8/0x150 mm/filemap.c:948\n__filemap_get_folio+0x510/0x6d0 mm/filemap.c:1981\npagecache_get_page+0x26/0x190 mm/folio-compat.c:104\ngrab_cache_page_write_begin+0x2a/0x30 mm/folio-compat.c:116\next4_da_write_begin+0x2dd/0x5f0 fs/ext4/inode.c:2988\ngeneric_perform_write+0x1d4/0x3f0 mm/filemap.c:3738\next4_buffered_write_iter+0x235/0x3e0 fs/ext4/file.c:270\next4_file_write_iter+0x2e3/0x1210\ncall_write_iter include/linux/fs.h:2187 [inline]\nnew_sync_write fs/read_write.c:491 [inline]\nvfs_write+0x468/0x760 fs/read_write.c:578\nksys_write+0xe8/0x1a0 fs/read_write.c:631\n__do_sys_write fs/read_write.c:643 [inline]\n__se_sys_write fs/read_write.c:640 [inline]\n__x64_sys_write+0x3e/0x50 fs/read_write.c:640\ndo_syscall_x64 arch/x86/entry/common.c:50 [inline]\ndo_syscall_64+0x2b/0x70 arch/x86/entry/common.c:80\nentry_SYSCALL_64_after_hwframe+0x63/0xcd\n\nread to 0xffffea0004a1d2c8 of 8 bytes by task 18611 on cpu 1:\npage_is_pfmemalloc include/linux/mm.h:1740 [inline]\n__skb_fill_page_desc include/linux/skbuff.h:2422 [inline]\nskb_fill_page_desc include/linux/skbuff.h:2443 [inline]\ntcp_build_frag+0x613/0xb20 net/ipv4/tcp.c:1018\ndo_tcp_sendpages+0x3e8/0xaf0 net/ipv4/tcp.c:1075\ntcp_sendpage_locked net/ipv4/tcp.c:1140 [inline]\ntcp_sendpage+0x89/0xb0 net/ipv4/tcp.c:1150\ninet_sendpage+0x7f/0xc0 net/ipv4/af_inet.c:833\nkernel_sendpage+0x184/0x300 net/socket.c:3561\nsock_sendpage+0x5a/0x70 net/socket.c:1054\npipe_to_sendpage+0x128/0x160 fs/splice.c:361\nsplice_from_pipe_feed fs/splice.c:415 [inline]\n__splice_from_pipe+0x222/0x4d0 fs/splice.c:559\nsplice_from_pipe fs/splice.c:594 [inline]\ngeneric_splice_sendpage+0x89/0xc0 fs/splice.c:743\ndo_splice_from fs/splice.c:764 [inline]\ndirect_splice_actor+0x80/0xa0 fs/splice.c:931\nsplice_direct_to_actor+0x305/0x620 fs/splice.c:886\ndo_splice_direct+0xfb/0x180 fs/splice.c:974\ndo_sendfile+0x3bf/0x910 fs/read_write.c:1249\n__do_sys_sendfile64 fs/read_write.c:1317 [inline]\n__se_sys_sendfile64 fs/read_write.c:1303 [inline]\n__x64_sys_sendfile64+0x10c/0x150 fs/read_write.c:1303\ndo_syscall_x64 arch/x86/entry/common.c:50 [inline]\ndo_syscall_64+0x2b/0x70 arch/x86/entry/common.c:80\nentry_SYSCALL_64_after_hwframe+0x63/0xcd\n\nvalue changed: 0x0000000000000000 -> 0xffffea0004a1d288\n\nReported by Kernel Concurrency Sanitizer on:\nCPU: 1 PID: 18611 Comm: syz-executor.4 Not tainted 6.0.0-rc2-syzkaller-00248-ge022620b5d05-dirty #0\nHardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 07/22/2022",
    "cvss3": {
        "cvss": 7.0,
        "exploitability_score": 1.0,
        "impact_score": 5.9,
        "vector": "CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:H/I:H/A:H"
    },
    "cvss2": null,
    "cpes": [
        {
            "id": 754455
        },
        {
            "id": 754456
        },
        {
            "id": 754457
        },
        {
            "id": 780049
        },
        {
            "id": 780050
        },
        {
            "id": 780051
        },
        {
            "id": 780052
        },
        {
            "id": 780187
        },
        {
            "id": 780188
        },
        {
            "id": 780189
        },
        {
            "id": 780190
        },
        {
            "id": 780191
        },
        {
            "id": 780192
        },
        {
            "id": 780193
        },
        {
            "id": 780194
        },
        {
            "id": 780195
        },
        {
            "id": 799197
        },
        {
            "id": 799198
        },
        {
            "id": 799199
        },
        {
            "id": 799200
        },
        {
            "id": 799201
        },
        {
            "id": 804763
        },
        {
            "id": 804764
        },
        {
            "id": 804765
        },
        {
            "id": 804766
        },
        {
            "id": 804767
        },
        {
            "id": 804768
        },
        {
            "id": 804769
        },
        {
            "id": 805346
        },
        {
            "id": 805347
        },
        {
            "id": 822035
        },
        {
            "id": 822036
        },
        {
            "id": 822037
        },
        {
            "id": 822038
        },
        {
            "id": 822039
        },
        {
            "id": 822040
        },
        {
            "id": 822041
        },
        {
            "id": 822042
        },
        {
            "id": 822043
        },
        {
            "id": 822044
        },
        {
            "id": 830197
        },
        {
            "id": 830198
        },
        {
            "id": 830199
        },
        {
            "id": 832472
        },
        {
            "id": 832473
        },
        {
            "id": 832570
        },
        {
            "id": 832571
        },
        {
            "id": 832572
        },
        {
            "id": 832573
        },
        {
            "id": 832574
        },
        {
            "id": 832575
        },
        {
            "id": 832576
        },
        {
            "id": 834013
        },
        {
            "id": 834014
        },
        {
            "id": 834015
        },
        {
            "id": 834016
        },
        {
            "id": 834017
        },
        {
            "id": 834018
        },
        {
            "id": 834019
        },
        {
            "id": 834020
        },
        {
            "id": 834021
        },
        {
            "id": 834022
        },
        {
            "id": 834023
        },
        {
            "id": 834024
        },
        {
            "id": 834025
        },
        {
            "id": 843413
        },
        {
            "id": 843414
        },
        {
            "id": 843415
        },
        {
            "id": 843416
        },
        {
            "id": 843417
        },
        {
            "id": 846180
        },
        {
            "id": 846181
        },
        {
            "id": 853210
        },
        {
            "id": 853211
        },
        {
            "id": 855336
        },
        {
            "id": 855469
        },
        {
            "id": 855470
        },
        {
            "id": 855471
        },
        {
            "id": 855472
        },
        {
            "id": 855473
        },
        {
            "id": 856834
        },
        {
            "id": 859539
        },
        {
            "id": 862474
        },
        {
            "id": 864623
        },
        {
            "id": 866511
        },
        {
            "id": 868630
        },
        {
            "id": 871480
        },
        {
            "id": 871481
        },
        {
            "id": 871482
        },
        {
            "id": 871483
        },
        {
            "id": 871484
        },
        {
            "id": 871485
        },
        {
            "id": 871486
        },
        {
            "id": 874231
        },
        {
            "id": 876927
        },
        {
            "id": 876928
        },
        {
            "id": 886711
        },
        {
            "id": 888655
        },
        {
            "id": 889644
        },
        {
            "id": 889645
        },
        {
            "id": 889646
        },
        {
            "id": 889647
        },
        {
            "id": 889648
        },
        {
            "id": 889649
        },
        {
            "id": 890594
        },
        {
            "id": 892676
        },
        {
            "id": 895161
        },
        {
            "id": 895546
        },
        {
            "id": 895547
        },
        {
            "id": 895548
        },
        {
            "id": 895567
        },
        {
            "id": 895568
        },
        {
            "id": 895569
        },
        {
            "id": 895570
        },
        {
            "id": 895571
        },
        {
            "id": 895572
        },
        {
            "id": 895573
        },
        {
            "id": 895574
        },
        {
            "id": 895575
        },
        {
            "id": 907081
        },
        {
            "id": 907082
        },
        {
            "id": 907083
        },
        {
            "id": 907084
        },
        {
            "id": 907085
        },
        {
            "id": 918469
        },
        {
            "id": 920003
        },
        {
            "id": 920004
        },
        {
            "id": 920005
        },
        {
            "id": 920006
        },
        {
            "id": 931455
        },
        {
            "id": 932498
        },
        {
            "id": 934638
        },
        {
            "id": 934639
        },
        {
            "id": 934640
        },
        {
            "id": 934641
        },
        {
            "id": 934642
        },
        {
            "id": 934643
        },
        {
            "id": 937547
        },
        {
            "id": 937712
        },
        {
            "id": 937732
        },
        {
            "id": 951699
        },
        {
            "id": 951700
        },
        {
            "id": 951701
        },
        {
            "id": 951702
        },
        {
            "id": 951703
        },
        {
            "id": 951704
        },
        {
            "id": 951705
        },
        {
            "id": 951706
        },
        {
            "id": 951707
        },
        {
            "id": 951708
        },
        {
            "id": 951709
        },
        {
            "id": 951710
        },
        {
            "id": 951711
        },
        {
            "id": 951712
        },
        {
            "id": 951713
        },
        {
            "id": 951714
        },
        {
            "id": 951715
        },
        {
            "id": 951716
        },
        {
            "id": 951717
        },
        {
            "id": 951718
        },
        {
            "id": 951719
        },
        {
            "id": 951720
        },
        {
            "id": 951721
        },
        {
            "id": 951722
        },
        {
            "id": 951723
        },
        {
            "id": 951724
        },
        {
            "id": 951725
        },
        {
            "id": 951726
        },
        {
            "id": 951727
        },
        {
            "id": 951728
        },
        {
            "id": 951729
        },
        {
            "id": 951730
        },
        {
            "id": 951731
        },
        {
            "id": 951732
        },
        {
            "id": 951733
        },
        {
            "id": 951734
        },
        {
            "id": 951735
        },
        {
            "id": 951736
        },
        {
            "id": 951737
        },
        {
            "id": 951738
        },
        {
            "id": 951739
        },
        {
            "id": 951740
        },
        {
            "id": 951741
        },
        {
            "id": 951742
        },
        {
            "id": 951743
        },
        {
            "id": 951744
        },
        {
            "id": 951745
        },
        {
            "id": 951746
        },
        {
            "id": 951754
        },
        {
            "id": 951755
        },
        {
            "id": 951756
        },
        {
            "id": 951757
        },
        {
            "id": 951758
        },
        {
            "id": 951759
        },
        {
            "id": 951760
        },
        {
            "id": 951761
        },
        {
            "id": 951762
        },
        {
            "id": 951763
        },
        {
            "id": 951764
        },
        {
            "id": 951765
        },
        {
            "id": 951766
        },
        {
            "id": 951767
        },
        {
            "id": 951768
        },
        {
            "id": 1065084
        },
        {
            "id": 1267332
        }
    ]
}